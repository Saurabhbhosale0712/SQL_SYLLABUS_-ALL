-- DEMO TABLES WITH OUTPUT AND USE CASES
-- Table: employees
CREATE TABLE employees (
    emp_id INT,
    name VARCHAR(50),
    department_id INT,
    salary INT
);

INSERT INTO employees VALUES
(1, 'Alice', 1, 50000),
(2, 'Bob', 1, 60000),
(3, 'Charlie', 2, 55000),
(4, 'David', 2, 70000),
(5, 'Eve', 3, 45000);

-- Table: departments
CREATE TABLE departments (
    department_id INT,
    department_name VARCHAR(50)
);

INSERT INTO departments VALUES
(1, 'HR'),
(2, 'IT'),
(3, 'Finance');

-- 6. Aggregate Functions
-- COUNT(): Count total number of employees
SELECT COUNT(*) AS total_employees FROM employees;
-- Output: 5

-- SUM(): Total salary expense
SELECT SUM(salary) AS total_salary FROM employees;
-- Output: 280000

-- AVG(): Average salary
SELECT AVG(salary) AS average_salary FROM employees;
-- Output: 56000

-- MIN(), MAX(): Minimum and maximum salary
SELECT MIN(salary) AS min_salary, MAX(salary) AS max_salary FROM employees;
-- Output: 45000, 70000


-- 7. GROUP BY and HAVING
-- GROUP BY: Count employees per department
SELECT department_id, COUNT(*) AS emp_count FROM employees GROUP BY department_id;
-- Output: 1 -> 2, 2 -> 2, 3 -> 1

-- HAVING vs WHERE: Filter departments where average salary > 50000
SELECT department_id, AVG(salary) AS avg_sal FROM employees
GROUP BY department_id
HAVING AVG(salary) > 50000;
-- Output: dept 1 and 2 (avg salaries > 50000)

-- Combine GROUP BY with aggregate functions
SELECT department_id, MAX(salary), MIN(salary) FROM employees GROUP BY department_id;
-- Output: max/min salary per department


-- 8. Joins
-- INNER JOIN: Get employee names with their department
SELECT e.name, d.department_name FROM employees e
INNER JOIN departments d ON e.department_id = d.department_id;
-- Output: All employees with matching department names

-- LEFT JOIN: Keep all employees, even if dept missing
SELECT e.name, d.department_name FROM employees e
LEFT JOIN departments d ON e.department_id = d.department_id;
-- Output: All employees with department names (null if not matched)

-- RIGHT JOIN: Keep all departments, even if no employees
SELECT e.name, d.department_name FROM employees e
RIGHT JOIN departments d ON e.department_id = d.department_id;
-- Output: All departments with employees if any

-- FULL JOIN: All employees and departments (matched + unmatched)
SELECT e.name, d.department_name FROM employees e
LEFT JOIN departments d ON e.department_id = d.department_id
UNION
SELECT e.name, d.department_name FROM employees e
RIGHT JOIN departments d ON e.department_id = d.department_id;
-- Output: All combinations with nulls if not matched

-- CROSS JOIN: Every combination of employee and department
SELECT e.name, d.department_name FROM employees e
CROSS JOIN departments d;
-- Output: 15 rows (5x3)

-- SELF JOIN: Pairs of employees in same department
SELECT e1.name AS employee1, e2.name AS employee2
FROM employees e1
JOIN employees e2 ON e1.department_id = e2.department_id AND e1.emp_id <> e2.emp_id;
-- Output: Employee pairs in same department


-- 9. Subqueries
-- In SELECT: Compare with overall average
SELECT name, salary, (SELECT AVG(salary) FROM employees) AS overall_avg FROM employees;
-- Output: Each employee's salary and overall avg

-- In FROM: Use result of GROUP BY subquery
SELECT dept_avg.department_id, dept_avg.avg_salary FROM (
    SELECT department_id, AVG(salary) AS avg_salary
    FROM employees GROUP BY department_id
) AS dept_avg;
-- Output: Department-wise average salaries

-- In WHERE: Employees with above-average salary
SELECT name FROM employees WHERE salary > (
    SELECT AVG(salary) FROM employees
);
-- Output: Bob, David (their salaries > 56000)

-- Correlated Subquery: Compare salary within same dept
SELECT name FROM employees e1
WHERE salary > (
    SELECT AVG(salary) FROM employees e2 WHERE e1.department_id = e2.department_id
);
-- Output: Bob, David (highest in their depts)


-- 10. Set Operations
-- UNION: Unique names from dept 1 and 2
SELECT name FROM employees WHERE department_id = 1
UNION
SELECT name FROM employees WHERE department_id = 2;
-- Output: Alice, Bob, Charlie, David

-- UNION ALL: Include duplicates (if any)
SELECT name FROM employees WHERE department_id = 1
UNION ALL
SELECT name FROM employees WHERE department_id = 2;
-- Output: Same as above (no duplicates in this case)

-- INTERSECT: Names common in dept 1 and those with salary > 55000
SELECT name FROM employees WHERE department_id = 1
INTERSECT
SELECT name FROM employees WHERE salary > 55000;
-- Output: Bob

-- EXCEPT: Names in dept 1 but not with salary > 55000
SELECT name FROM employees WHERE department_id = 1
EXCEPT
SELECT name FROM employees WHERE salary > 55000;
-- Output: Alice
